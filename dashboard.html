<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Richard Olson | Building in Public â€” Live Dashboard</title>
    <meta name="description" content="Real-time metrics from my executive job search. Every number tracked, every lesson shared.">

    <!-- Open Graph for LinkedIn sharing -->
    <meta property="og:title" content="Richard Olson | Building in Public Dashboard">
    <meta property="og:description" content="Real-time job search metrics. Transparent by design.">
    <meta property="og:type" content="website">

    <!-- Google Analytics â€” Replace G-PEKQWW46GW with your Measurement ID -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-PEKQWW46GW"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-PEKQWW46GW');
    </script>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=DM+Serif+Display&family=Instrument+Sans:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">

    <style>
        :root {
            --bg-primary: #0a0a0c;
            --bg-secondary: #111115;
            --bg-card: #16161b;
            --bg-accent: #1c1c23;
            --text-primary: #e8e6e1;
            --text-secondary: #9a9890;
            --text-muted: #5a5850;
            --accent: #c8a44e;
            --accent-dim: #8a7235;
            --accent-glow: rgba(200, 164, 78, 0.12);
            --green: #5a9e6f;
            --green-dim: rgba(90, 158, 111, 0.15);
            --blue: #4a7eb5;
            --blue-dim: rgba(74, 126, 181, 0.15);
            --red: #c75050;
            --red-dim: rgba(199, 80, 80, 0.15);
            --border: #222228;
            --font-display: 'DM Serif Display', Georgia, serif;
            --font-body: 'Instrument Sans', -apple-system, sans-serif;
            --font-mono: 'JetBrains Mono', monospace;
        }

        *, *::before, *::after { margin: 0; padding: 0; box-sizing: border-box; }
        html { scroll-behavior: smooth; font-size: 16px; }

        body {
            font-family: var(--font-body);
            background: var(--bg-primary);
            color: var(--text-primary);
            line-height: 1.7;
            -webkit-font-smoothing: antialiased;
            overflow-x: hidden;
        }

        ::selection { background: var(--accent); color: var(--bg-primary); }

        /* â”€â”€â”€ Navigation â”€â”€â”€ */
        nav {
            position: fixed;
            top: 0;
            width: 100%;
            z-index: 100;
            padding: 1.25rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: rgba(10, 10, 12, 0.85);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid var(--border);
        }

        .nav-logo {
            font-family: var(--font-mono);
            font-size: 0.8rem;
            letter-spacing: 0.15em;
            text-transform: uppercase;
            color: var(--accent);
            text-decoration: none;
        }

        .nav-links {
            display: flex;
            gap: 2rem;
            list-style: none;
        }

        .nav-links a {
            color: var(--text-secondary);
            text-decoration: none;
            font-size: 0.85rem;
            font-weight: 500;
            letter-spacing: 0.03em;
            transition: color 0.3s ease;
        }

        .nav-links a:hover { color: var(--accent); }

        .nav-mobile-toggle {
            display: none;
            background: none;
            border: none;
            color: var(--text-primary);
            font-size: 1.5rem;
            cursor: pointer;
        }

        /* â”€â”€â”€ Header â”€â”€â”€ */
        .dash-header {
            padding: 7rem 2rem 3rem;
            max-width: 1200px;
            margin: 0 auto;
        }

        .dash-header-top {
            display: flex;
            justify-content: space-between;
            align-items: flex-end;
            flex-wrap: wrap;
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .section-label {
            font-family: var(--font-mono);
            font-size: 0.7rem;
            letter-spacing: 0.2em;
            text-transform: uppercase;
            color: var(--accent);
            margin-bottom: 0.75rem;
        }

        .dash-title {
            font-family: var(--font-display);
            font-size: clamp(2rem, 5vw, 3.2rem);
            line-height: 1.1;
        }

        .dash-subtitle {
            color: var(--text-secondary);
            font-size: 1.05rem;
            max-width: 650px;
            margin-bottom: 1rem;
        }

        .last-updated {
            font-family: var(--font-mono);
            font-size: 0.75rem;
            color: var(--text-muted);
            letter-spacing: 0.05em;
        }

        .last-updated span { color: var(--green); }

        .status-dot {
            display: inline-block;
            width: 7px;
            height: 7px;
            border-radius: 50%;
            background: var(--green);
            margin-right: 4px;
            animation: pulse 2s ease infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.4; }
        }

        /* â”€â”€â”€ KPI Row â”€â”€â”€ */
        .kpi-row {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 1rem;
            padding: 0 2rem 3rem;
            max-width: 1200px;
            margin: 0 auto;
        }

        .kpi-card {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 1.5rem;
            position: relative;
            overflow: hidden;
            transition: all 0.3s ease;
        }

        .kpi-card:hover {
            border-color: var(--accent-dim);
            transform: translateY(-2px);
            box-shadow: 0 8px 30px rgba(0,0,0,0.3);
        }

        .kpi-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 2px;
        }

        .kpi-card.gold::before { background: var(--accent); }
        .kpi-card.green::before { background: var(--green); }
        .kpi-card.blue::before { background: var(--blue); }

        .kpi-label {
            font-size: 0.75rem;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.08em;
            margin-bottom: 0.5rem;
        }

        .kpi-value {
            font-family: var(--font-display);
            font-size: 2.2rem;
            line-height: 1.1;
        }

        .kpi-card.gold .kpi-value { color: var(--accent); }
        .kpi-card.green .kpi-value { color: var(--green); }
        .kpi-card.blue .kpi-value { color: var(--blue); }

        .kpi-change {
            font-family: var(--font-mono);
            font-size: 0.7rem;
            margin-top: 0.4rem;
            display: inline-flex;
            align-items: center;
            gap: 0.25rem;
            padding: 0.15rem 0.5rem;
            border-radius: 3px;
        }

        .kpi-change.up { color: var(--green); background: var(--green-dim); }
        .kpi-change.down { color: var(--red); background: var(--red-dim); }
        .kpi-change.neutral { color: var(--text-muted); background: var(--bg-accent); }

        /* â”€â”€â”€ Content Sections â”€â”€â”€ */
        .dash-content {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 2rem 4rem;
        }

        .two-col {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1.5rem;
            margin-bottom: 3rem;
        }

        .dash-card {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 2rem;
        }

        .dash-card-title {
            font-family: var(--font-mono);
            font-size: 0.7rem;
            letter-spacing: 0.15em;
            text-transform: uppercase;
            color: var(--accent);
            margin-bottom: 1.5rem;
        }

        /* â”€â”€â”€ Weekly Trend Table â”€â”€â”€ */
        .trend-table {
            width: 100%;
            border-collapse: collapse;
        }

        .trend-table th {
            font-family: var(--font-mono);
            font-size: 0.65rem;
            letter-spacing: 0.1em;
            text-transform: uppercase;
            color: var(--text-muted);
            text-align: left;
            padding: 0.5rem 0.75rem;
            border-bottom: 1px solid var(--border);
        }

        .trend-table td {
            font-size: 0.85rem;
            padding: 0.65rem 0.75rem;
            border-bottom: 1px solid rgba(34, 34, 40, 0.5);
            color: var(--text-secondary);
        }

        .trend-table tr:last-child td { border-bottom: none; }

        .trend-table tr:hover td { color: var(--text-primary); }

        .trend-table .highlight {
            color: var(--accent);
            font-weight: 600;
        }

        /* â”€â”€â”€ Bar Chart (CSS only) â”€â”€â”€ */
        .bar-chart {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }

        .bar-row {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .bar-label {
            font-size: 0.8rem;
            color: var(--text-secondary);
            width: 120px;
            flex-shrink: 0;
        }

        .bar-track {
            flex: 1;
            height: 28px;
            background: var(--bg-accent);
            border-radius: 4px;
            overflow: hidden;
            position: relative;
        }

        .bar-fill {
            height: 100%;
            border-radius: 4px;
            transition: width 1.5s ease;
            display: flex;
            align-items: center;
            justify-content: flex-end;
            padding-right: 0.5rem;
            font-family: var(--font-mono);
            font-size: 0.7rem;
            color: var(--bg-primary);
            font-weight: 600;
        }

        .bar-fill.gold { background: var(--accent); }
        .bar-fill.green { background: var(--green); }
        .bar-fill.blue { background: var(--blue); }

        /* â”€â”€â”€ Milestones â”€â”€â”€ */
        .milestones {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .milestone {
            display: flex;
            gap: 1rem;
            align-items: flex-start;
        }

        .milestone-check {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.75rem;
            flex-shrink: 0;
            margin-top: 2px;
        }

        .milestone-check.done {
            background: var(--green-dim);
            color: var(--green);
            border: 1px solid var(--green);
        }

        .milestone-check.pending {
            background: var(--bg-accent);
            color: var(--text-muted);
            border: 1px solid var(--border);
        }

        .milestone-text {
            font-size: 0.9rem;
            color: var(--text-secondary);
        }

        .milestone-text strong {
            color: var(--text-primary);
            display: block;
        }

        .milestone-text .date {
            font-family: var(--font-mono);
            font-size: 0.7rem;
            color: var(--text-muted);
        }

        /* â”€â”€â”€ Loading State â”€â”€â”€ */
        .loading-state {
            text-align: center;
            padding: 4rem 2rem;
            color: var(--text-muted);
        }

        .loading-spinner {
            width: 30px;
            height: 30px;
            border: 2px solid var(--border);
            border-top-color: var(--accent);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 1rem;
        }

        @keyframes spin { to { transform: rotate(360deg); } }

        /* â”€â”€â”€ Methodology Note â”€â”€â”€ */
        .methodology {
            border-top: 1px solid var(--border);
            padding: 3rem 2rem;
            max-width: 1200px;
            margin: 0 auto;
        }

        .methodology p {
            font-size: 0.85rem;
            color: var(--text-muted);
            max-width: 700px;
        }

        .methodology a {
            color: var(--accent);
            text-decoration: none;
        }

        /* â”€â”€â”€ Footer â”€â”€â”€ */
        footer {
            border-top: 1px solid var(--border);
            padding: 2rem;
            text-align: center;
            font-size: 0.8rem;
            color: var(--text-muted);
        }

        footer a {
            color: var(--accent);
            text-decoration: none;
        }

        /* â”€â”€â”€ Responsive â”€â”€â”€ */
        @media (max-width: 900px) {
            .kpi-row { grid-template-columns: repeat(3, 1fr); }
            .two-col { grid-template-columns: 1fr; }
            .nav-links { display: none; }
            .nav-links.open {
                display: flex;
                flex-direction: column;
                position: absolute;
                top: 100%;
                left: 0;
                right: 0;
                background: var(--bg-primary);
                border-bottom: 1px solid var(--border);
                padding: 1.5rem 2rem;
                gap: 1rem;
            }
            .nav-mobile-toggle { display: block; }
        }

        @media (max-width: 600px) {
            .kpi-row { grid-template-columns: 1fr 1fr; }
            .dash-header { padding: 6rem 1.25rem 2rem; }
            .kpi-row { padding: 0 1.25rem 2rem; }
            .dash-content { padding: 0 1.25rem 3rem; }
            .bar-label { width: 80px; font-size: 0.7rem; }
        }

        /* â”€â”€â”€ Reveal Animation â”€â”€â”€ */
        .reveal {
            opacity: 0;
            transform: translateY(20px);
            transition: opacity 0.6s ease, transform 0.6s ease;
        }

        .reveal.visible {
            opacity: 1;
            transform: translateY(0);
        }
    </style>
</head>
<body>

<!-- â•â•â• Navigation â•â•â• -->
<nav>
    <a href="https://r4olson.github.io" class="nav-logo">R. Olson</a>
    <button class="nav-mobile-toggle" onclick="document.querySelector('.nav-links').classList.toggle('open')" aria-label="Toggle menu">â˜°</button>
    <ul class="nav-links">
        <li><a href="https://r4olson.github.io">Portfolio</a></li>
        <li><a href="https://r4olson.github.io/dashboard.html">Dashboard</a></li>
        <li><a href="https://r4olson.github.io/movement.html">The Movement</a></li>
        <li><a href="https://www.linkedin.com/in/olson-richard" target="_blank">LinkedIn</a></li>
    </ul>
</nav>

<!-- â•â•â• Header â•â•â• -->
<header class="dash-header">
    <div class="section-label">Building in Public</div>
    <div class="dash-header-top">
        <div>
            <h1 class="dash-title">Live Dashboard</h1>
            <p class="dash-subtitle">Tracking my executive career transition in real time. Every metric, every week, no filter.</p>
        </div>
        <div class="last-updated">
            <span class="status-dot"></span> Last updated: <span id="lastUpdated">Loading...</span>
        </div>
    </div>
</header>

<!-- â•â•â• KPI Row â•â•â• -->
<div class="kpi-row" id="kpiRow">
    <div class="kpi-card gold">
        <div class="kpi-label">Current Week</div>
        <div class="kpi-value" id="kpiWeek">â€”</div>
        <div class="kpi-change neutral" id="kpiWeekSub">of 12</div>
    </div>
    <div class="kpi-card gold">
        <div class="kpi-label">Total Impressions</div>
        <div class="kpi-value" id="kpiImpressions">â€”</div>
        <div class="kpi-change neutral" id="kpiImpressionsChange">loading</div>
    </div>
    <div class="kpi-card green">
        <div class="kpi-label">Meetings Booked</div>
        <div class="kpi-value" id="kpiMeetings">â€”</div>
        <div class="kpi-change neutral" id="kpiMeetingsChange">loading</div>
    </div>
    <div class="kpi-card blue">
        <div class="kpi-label">Profile Views</div>
        <div class="kpi-value" id="kpiProfileViews">â€”</div>
        <div class="kpi-change neutral" id="kpiProfileViewsChange">loading</div>
    </div>
    <div class="kpi-card green">
        <div class="kpi-label">New Connections</div>
        <div class="kpi-value" id="kpiConnections">â€”</div>
        <div class="kpi-change neutral" id="kpiConnectionsChange">loading</div>
    </div>
</div>

<!-- â•â•â• Dashboard Content â•â•â• -->
<div class="dash-content">

    <!-- Weekly Trends + Content Performance -->
    <div class="two-col reveal">
        <div class="dash-card">
            <div class="dash-card-title">Weekly Trends</div>
            <table class="trend-table" id="weeklyTable">
                <thead>
                    <tr>
                        <th>Week</th>
                        <th>Impressions</th>
                        <th>Reactions</th>
                        <th>Comments</th>
                        <th>Profile Views</th>
                    </tr>
                </thead>
                <tbody id="weeklyTableBody">
                    <tr><td colspan="5" style="text-align:center; color: var(--text-muted);">Loading data from Google Sheets...</td></tr>
                </tbody>
            </table>
        </div>

        <div class="dash-card">
            <div class="dash-card-title">Content Performance: Vulnerability vs AI</div>
            <div class="bar-chart" id="contentBars">
                <p style="color: var(--text-muted); font-size: 0.85rem;">Loading...</p>
            </div>
        </div>
    </div>

    <!-- Funnel + Milestones -->
    <div class="two-col reveal">
        <div class="dash-card">
            <div class="dash-card-title">Job Search Funnel</div>
            <div class="bar-chart" id="funnelBars">
                <p style="color: var(--text-muted); font-size: 0.85rem;">Loading...</p>
            </div>
        </div>

        <div class="dash-card">
            <div class="dash-card-title">Milestones</div>
            <div class="milestones" id="milestonesList">
                <p style="color: var(--text-muted); font-size: 0.85rem;">Loading...</p>
            </div>
        </div>
    </div>

</div>

<!-- â•â•â• Methodology â•â•â• -->
<div class="methodology">
    <div class="section-label">Methodology</div>
    <p>All metrics are self-reported from LinkedIn Analytics, personal tracking, and direct outreach records. Updated weekly on Mondays. Impressions and engagement data come directly from LinkedIn's creator analytics. Meeting and application counts are tracked manually. This dashboard is part of my <a href="https://www.linkedin.com/in/olson-richard" target="_blank">Building in Public</a> commitment to radical transparency in the job search process.</p>
</div>

<!-- â•â•â• Footer â•â•â• -->
<footer>
    <p>Â© 2026 Richard Olson Â· <a href="https://r4olson.github.io">Portfolio</a> Â· <a href="https://www.linkedin.com/in/olson-richard" target="_blank">LinkedIn</a> Â· Built with purpose. Everything shared is true.</p>
</footer>

<!-- â•â•â• Google Sheets Integration â•â•â• -->
<script>
/*
 * â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
 * SETUP INSTRUCTIONS:
 * 
 * 1. Create a Google Sheet with these exact column headers in Row 1:
 *    
 *    Sheet 1 â€” "Weekly" (weekly metrics):
 *    Week | Impressions | Reactions | Comments | Profile_Views | New_Followers | New_Connections | Meetings_Booked | DMs_Received | Applications_Sent | Interviews
 *    
 *    Sheet 2 â€” "Content" (per-post performance):
 *    Post_Date | Type | Title | Impressions | Reactions | Comments
 *    (Type should be "Vulnerability" or "AI")
 *    
 *    Sheet 3 â€” "Milestones":
 *    Milestone | Date | Status
 *    (Status should be "done" or "pending")
 *    
 *    Sheet 4 â€” "Meta":
 *    Key | Value
 *    last_updated | 2026-02-10
 *
 * 2. File â†’ Share â†’ Publish to web â†’ Entire Document â†’ CSV â†’ Publish
 *
 * 3. Copy your Sheet ID from the URL:
 *    https://docs.google.com/spreadsheets/d/YOUR_SHEET_ID_HERE/edit
 *
 * 4. Paste it below replacing the placeholder:
 * â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
 */

const SHEET_ID = '1UemSyRvZnO-Vdk0LLqErNMKTnywE0AoOq4JD5i4U2Vg';

// We'll use the export/csv endpoint which is the most reliable for public sheets
function getSheetURL(sheetName) {
    return `https://docs.google.com/spreadsheets/d/${SHEET_ID}/export?format=csv&sheet=${encodeURIComponent(sheetName)}`;
}

const URLS = {
    weekly:     getSheetURL('Weekly'),
    content:    getSheetURL('Content'),
    milestones: getSheetURL('Milestones'),
    meta:       getSheetURL('Meta'),
};

// â”€â”€â”€ CSV Parser â”€â”€â”€
function parseCSV(text) {
    const lines = text.trim().split('\n');
    const headers = parseCSVRow(lines[0]);
    return lines.slice(1).map(line => {
        const values = parseCSVRow(line);
        const obj = {};
        headers.forEach((h, i) => obj[h.trim().replace(/^"|"$/g, '')] = (values[i] || '').trim().replace(/^"|"$/g, ''));
        return obj;
    });
}

function parseCSVRow(row) {
    const result = [];
    let current = '';
    let inQuotes = false;
    for (let i = 0; i < row.length; i++) {
        const char = row[i];
        if (char === '"') {
            if (inQuotes && row[i + 1] === '"') { current += '"'; i++; }
            else { inQuotes = !inQuotes; }
        } else if (char === ',' && !inQuotes) {
            result.push(current); current = '';
        } else {
            current += char;
        }
    }
    result.push(current);
    return result;
}

// â”€â”€â”€ Number Formatting â”€â”€â”€
function fmt(n) {
    const num = parseInt(n) || 0;
    if (num >= 1000000) return (num / 1000000).toFixed(1) + 'M';
    if (num >= 1000) return (num / 1000).toFixed(1) + 'K';
    return num.toString();
}

function pctChange(current, previous) {
    if (!previous || previous === 0) return { text: 'new', cls: 'neutral' };
    const change = ((current - previous) / previous * 100).toFixed(0);
    if (change > 0) return { text: `â†‘ ${change}%`, cls: 'up' };
    if (change < 0) return { text: `â†“ ${Math.abs(change)}%`, cls: 'down' };
    return { text: 'â†’ 0%', cls: 'neutral' };
}

// â”€â”€â”€ Render Functions â”€â”€â”€
async function fetchSheet(url, name) {
    try {
        const response = await fetch(url);
        if (!response.ok) throw new Error(`${name}: HTTP ${response.status}`);
        const text = await response.text();
        if (text.includes('<!DOCTYPE') || text.includes('<html')) {
            throw new Error(`${name}: Got HTML instead of CSV â€” sheet may not be shared publicly`);
        }
        return parseCSV(text);
    } catch (err) {
        console.error(`Error fetching ${name}:`, err);
        return [];
    }
}

async function loadDashboard() {
    try {
        document.getElementById('lastUpdated').textContent = 'Fetching data...';

        const [weeklyData, contentData, milestoneData, metaData] = await Promise.all([
            fetchSheet(URLS.weekly, 'Weekly'),
            fetchSheet(URLS.content, 'Content'),
            fetchSheet(URLS.milestones, 'Milestones'),
            fetchSheet(URLS.meta, 'Meta'),
        ]);

        console.log('Weekly rows:', weeklyData.length, weeklyData);
        console.log('Content rows:', contentData.length, contentData);
        console.log('Milestone rows:', milestoneData.length, milestoneData);
        console.log('Meta rows:', metaData.length, metaData);

        if (weeklyData.length === 0 && contentData.length === 0 && milestoneData.length === 0 && metaData.length === 0) {
            document.getElementById('lastUpdated').textContent = 'Error: No data returned â€” check that sheet is shared as "Anyone with the link"';
            return;
        }

        renderMeta(metaData);
        renderKPIs(weeklyData);
        renderWeeklyTable(weeklyData);
        renderContentBars(contentData);
        renderFunnel(weeklyData);
        renderMilestones(milestoneData);
    } catch (err) {
        console.error('Dashboard load error:', err);
        document.getElementById('lastUpdated').textContent = 'Error: ' + err.message;
    }
}

function renderMeta(data) {
    const meta = {};
    data.forEach(row => {
        // Try multiple possible column name formats
        const key = row.Key || row.key || row.KEY || Object.values(row)[0] || '';
        const val = row.Value || row.value || row.VALUE || Object.values(row)[1] || '';
        meta[key.trim().toLowerCase()] = val.trim();
    });
    const updated = meta['last_updated'] || meta['lastupdated'] || meta['date'] || '';
    document.getElementById('lastUpdated').textContent = updated || 'Check Meta sheet setup';
}

function renderKPIs(weeks) {
    if (weeks.length === 0) return;
    const latest = weeks[weeks.length - 1];
    const prev = weeks.length > 1 ? weeks[weeks.length - 2] : null;

    document.getElementById('kpiWeek').textContent = latest.Week || weeks.length;
    document.getElementById('kpiWeekSub').textContent = `of 12`;

    // Total impressions
    const totalImpressions = weeks.reduce((s, w) => s + (parseInt(w.Impressions) || 0), 0);
    document.getElementById('kpiImpressions').textContent = fmt(totalImpressions);
    const impChange = pctChange(parseInt(latest.Impressions) || 0, parseInt(prev?.Impressions) || 0);
    const impEl = document.getElementById('kpiImpressionsChange');
    impEl.textContent = impChange.text + ' this week';
    impEl.className = 'kpi-change ' + impChange.cls;

    // Meetings
    const totalMeetings = weeks.reduce((s, w) => s + (parseInt(w.Meetings_Booked) || 0), 0);
    document.getElementById('kpiMeetings').textContent = totalMeetings;
    const meetChange = pctChange(parseInt(latest.Meetings_Booked) || 0, parseInt(prev?.Meetings_Booked) || 0);
    const meetEl = document.getElementById('kpiMeetingsChange');
    meetEl.textContent = `+${parseInt(latest.Meetings_Booked) || 0} this week`;
    meetEl.className = 'kpi-change ' + (parseInt(latest.Meetings_Booked) > 0 ? 'up' : 'neutral');

    // Profile Views
    const totalViews = weeks.reduce((s, w) => s + (parseInt(w.Profile_Views) || 0), 0);
    document.getElementById('kpiProfileViews').textContent = fmt(totalViews);
    const viewChange = pctChange(parseInt(latest.Profile_Views) || 0, parseInt(prev?.Profile_Views) || 0);
    const viewEl = document.getElementById('kpiProfileViewsChange');
    viewEl.textContent = viewChange.text + ' this week';
    viewEl.className = 'kpi-change ' + viewChange.cls;

    // Connections
    const totalConnections = weeks.reduce((s, w) => s + (parseInt(w.New_Connections) || 0), 0);
    document.getElementById('kpiConnections').textContent = totalConnections;
    const connChange = pctChange(parseInt(latest.New_Connections) || 0, parseInt(prev?.New_Connections) || 0);
    const connEl = document.getElementById('kpiConnectionsChange');
    connEl.textContent = `+${parseInt(latest.New_Connections) || 0} this week`;
    connEl.className = 'kpi-change ' + (parseInt(latest.New_Connections) > 0 ? 'up' : 'neutral');
}

function renderWeeklyTable(weeks) {
    const tbody = document.getElementById('weeklyTableBody');
    if (weeks.length === 0) {
        tbody.innerHTML = '<tr><td colspan="5" style="color:var(--text-muted)">No data yet</td></tr>';
        return;
    }
    tbody.innerHTML = weeks.slice(-8).reverse().map(w => `
        <tr>
            <td class="highlight">Wk ${w.Week}</td>
            <td>${fmt(parseInt(w.Impressions) || 0)}</td>
            <td>${parseInt(w.Reactions) || 0}</td>
            <td>${parseInt(w.Comments) || 0}</td>
            <td>${parseInt(w.Profile_Views) || 0}</td>
        </tr>
    `).join('');
}

function renderContentBars(content) {
    const container = document.getElementById('contentBars');
    if (content.length === 0) {
        container.innerHTML = '<p style="color:var(--text-muted);font-size:0.85rem;">No content data yet</p>';
        return;
    }

    const vuln = content.filter(c => c.Type === 'Vulnerability');
    const ai = content.filter(c => c.Type === 'AI');
    
    const avgVulnImpressions = vuln.length ? Math.round(vuln.reduce((s, c) => s + (parseInt(c.Impressions) || 0), 0) / vuln.length) : 0;
    const avgAIImpressions = ai.length ? Math.round(ai.reduce((s, c) => s + (parseInt(c.Impressions) || 0), 0) / ai.length) : 0;
    const avgVulnComments = vuln.length ? Math.round(vuln.reduce((s, c) => s + (parseInt(c.Comments) || 0), 0) / vuln.length) : 0;
    const avgAIComments = ai.length ? Math.round(ai.reduce((s, c) => s + (parseInt(c.Comments) || 0), 0) / ai.length) : 0;
    const avgVulnReactions = vuln.length ? Math.round(vuln.reduce((s, c) => s + (parseInt(c.Reactions) || 0), 0) / vuln.length) : 0;
    const avgAIReactions = ai.length ? Math.round(ai.reduce((s, c) => s + (parseInt(c.Reactions) || 0), 0) / ai.length) : 0;

    const maxImp = Math.max(avgVulnImpressions, avgAIImpressions, 1);
    const maxCom = Math.max(avgVulnComments, avgAIComments, 1);
    const maxReact = Math.max(avgVulnReactions, avgAIReactions, 1);

    container.innerHTML = `
        <p style="font-size:0.75rem;color:var(--text-muted);margin-bottom:0.75rem;text-transform:uppercase;letter-spacing:0.08em;">Avg Impressions per Post</p>
        <div class="bar-row">
            <div class="bar-label">ðŸ”¥ Vulnerability</div>
            <div class="bar-track"><div class="bar-fill gold" style="width:${(avgVulnImpressions/maxImp*100)}%">${fmt(avgVulnImpressions)}</div></div>
        </div>
        <div class="bar-row">
            <div class="bar-label">ðŸ¤– AI Practical</div>
            <div class="bar-track"><div class="bar-fill blue" style="width:${(avgAIImpressions/maxImp*100)}%">${fmt(avgAIImpressions)}</div></div>
        </div>
        <p style="font-size:0.75rem;color:var(--text-muted);margin:1.5rem 0 0.75rem;text-transform:uppercase;letter-spacing:0.08em;">Avg Comments per Post</p>
        <div class="bar-row">
            <div class="bar-label">ðŸ”¥ Vulnerability</div>
            <div class="bar-track"><div class="bar-fill gold" style="width:${(avgVulnComments/maxCom*100)}%">${avgVulnComments}</div></div>
        </div>
        <div class="bar-row">
            <div class="bar-label">ðŸ¤– AI Practical</div>
            <div class="bar-track"><div class="bar-fill blue" style="width:${(avgAIComments/maxCom*100)}%">${avgAIComments}</div></div>
        </div>
        <p style="font-size:0.75rem;color:var(--text-muted);margin:1.5rem 0 0.75rem;text-transform:uppercase;letter-spacing:0.08em;">Avg Reactions per Post</p>
        <div class="bar-row">
            <div class="bar-label">ðŸ”¥ Vulnerability</div>
            <div class="bar-track"><div class="bar-fill gold" style="width:${(avgVulnReactions/maxReact*100)}%">${avgVulnReactions}</div></div>
        </div>
        <div class="bar-row">
            <div class="bar-label">ðŸ¤– AI Practical</div>
            <div class="bar-track"><div class="bar-fill blue" style="width:${(avgAIReactions/maxReact*100)}%">${avgAIReactions}</div></div>
        </div>
    `;
}

function renderFunnel(weeks) {
    const container = document.getElementById('funnelBars');
    if (weeks.length === 0) {
        container.innerHTML = '<p style="color:var(--text-muted);font-size:0.85rem;">No data yet</p>';
        return;
    }

    const totals = {
        applications: weeks.reduce((s, w) => s + (parseInt(w.Applications_Sent) || 0), 0),
        interviews: weeks.reduce((s, w) => s + (parseInt(w.Interviews) || 0), 0),
        meetings: weeks.reduce((s, w) => s + (parseInt(w.Meetings_Booked) || 0), 0),
    };

    const maxFunnel = Math.max(totals.applications, 1);

    container.innerHTML = `
        <div class="bar-row">
            <div class="bar-label">Applications</div>
            <div class="bar-track"><div class="bar-fill gold" style="width:${(totals.applications/maxFunnel*100)}%">${totals.applications}</div></div>
        </div>
        <div class="bar-row">
            <div class="bar-label">Interviews</div>
            <div class="bar-track"><div class="bar-fill green" style="width:${Math.max((totals.interviews/maxFunnel*100), totals.interviews > 0 ? 15 : 0)}%">${totals.interviews}</div></div>
        </div>
        <div class="bar-row">
            <div class="bar-label">Meetings</div>
            <div class="bar-track"><div class="bar-fill blue" style="width:${Math.max((totals.meetings/maxFunnel*100), totals.meetings > 0 ? 15 : 0)}%">${totals.meetings}</div></div>
        </div>
    `;
}

function renderMilestones(milestones) {
    const container = document.getElementById('milestonesList');
    if (milestones.length === 0) {
        container.innerHTML = '<p style="color:var(--text-muted);font-size:0.85rem;">No milestones yet</p>';
        return;
    }

    container.innerHTML = milestones.map(m => `
        <div class="milestone">
            <div class="milestone-check ${m.Status === 'done' ? 'done' : 'pending'}">
                ${m.Status === 'done' ? 'âœ“' : 'â—‹'}
            </div>
            <div class="milestone-text">
                <strong>${m.Milestone}</strong>
                <span class="date">${m.Date || ''}</span>
            </div>
        </div>
    `).join('');
}

// â”€â”€â”€ Scroll Reveal â”€â”€â”€
const observer = new IntersectionObserver((entries) => {
    entries.forEach(entry => {
        if (entry.isIntersecting) entry.target.classList.add('visible');
    });
}, { threshold: 0.1 });

document.querySelectorAll('.reveal').forEach(el => observer.observe(el));

// â”€â”€â”€ Initialize â”€â”€â”€
loadDashboard();
</script>

</body>
</html>
